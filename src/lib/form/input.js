/**
  *
  * @authors yutent (yutent.io@gmail.com)
  * @date    2021-02-05 16:32:07
  * @version v1.0.3
  * 
  */

import"../scroll/index.js";import"../icon/index.js";import $ from"../utils.js";export default class Input extends HTMLElement{static get observedAttributes(){return["value","icon","placeholder","maxlength","minlength","autofocus","readonly","disabled","passwd","lazy"]}props={value:"",icon:"",placeholder:"",maxlength:null,minlength:null,autofocus:!1,readonly:!1,disabled:!1,passwd:!1,lazy:0};state={mvidx:null};constructor(){super(),Object.defineProperty(this,"root",{value:this.attachShadow({mode:"open"}),writable:!0,enumerable:!1,configurable:!0}),this.root.innerHTML='<style>*{box-sizing:border-box;margin:0;padding:0}::before,::after{box-sizing:border-box}ul,li{list-style:none}:host{overflow:hidden;display:inline-flex;min-width:128px;user-select:none;-moz-user-select:none;color:var(--color-dark-1);border-radius:6px;cursor:text;transition:box-shadow .15s linear}.label{flex:1;display:flex;justify-content:center;align-items:center;height:32px;font-size:14px;border:2px solid var(--color-plain-2);border-radius:inherit;background:var(--bg-color, #fff);color:inherit;cursor:inherit}.label input{flex:1;min-width:32px;width:0;height:100%;padding:0 6px;border:0;border-radius:inherit;color:inherit;font:inherit;background:none;outline:none;box-shadow:none;cursor:inherit}.label input::placeholder{color:var(--color-grey-1)}.label .prepend,.label .append{display:none;justify-content:center;align-items:center;width:auto;height:28px;padding:0 10px;line-height:1;background:var(--bg-color, --color-plain-1);white-space:nowrap}.label .prepend{border-right:2px solid var(--color-plain-a);border-radius:6px 0 0 6px}.label .append{border-left:2px solid var(--color-plain-a);border-radius:0 6px 6px 0}.label[prepend] .prepend,.label[append] .append{display:flex}.label[prepend] input,.label[append] input{min-width:64px}.label .icon{--size: 18px;margin:0 8px 0 4px;color:var(--color-grey-2)}.suggestion{display:none;position:fixed;z-index:10240;left:0;top:0;width:200px;height:auto;max-height:200px;min-height:46px;padding:8px 0;border-radius:2px;background:#fff;box-shadow:0 0 5px rgba(0,0,0,.25)}.suggestion .list{width:100%}.suggestion::after{position:absolute;left:30px;top:-4px;width:8px;height:8px;background:#fff;box-shadow:-1px -1px 2px rgba(0,0,0,.1);transform:rotate(45deg);content:""}.suggestion.show{display:flex}.suggestion li{overflow:hidden;width:100%;height:30px;line-height:30px;padding:0 8px;text-overflow:ellipsis;white-space:nowrap;cursor:pointer}.suggestion li:hover,.suggestion li[focus]{background:var(--color-plain-1)}:host([round]){border-radius:21px}:host([round]) .label input{padding:0 10px}:host([round]) .label[prepend] input,:host([round]) .label[append] input{padding:0 5px}:host([round]) .prepend{border-radius:21px 0 0 21px}:host([round]) .append{border-radius:0 21px 21px 0}:host([size=large]){min-width:212px}:host([size=large]) .label{height:52px;font-size:18px}:host([size=large]) .label input{padding:0 16px}:host([size=large]) .prepend,:host([size=large]) .append{height:48px}:host([size=large]) .icon{--size: 24px;margin:0 20px 0 4px}:host([size=medium]){min-width:160px}:host([size=medium]) .label{height:36px}:host([size=medium]) .label input{padding:0 10px}:host([size=medium]) .prepend,:host([size=medium]) .append{height:32px}:host([size=mini]){min-width:72px}:host([size=mini]) .label{height:26px;font-size:12px}:host([size=mini]) .icon{--size: 14px}:host([size=mini]) .prepend,:host([size=mini]) .append{height:22px}:host(:focus-within){box-shadow:0 0 0 2px var(--color-plain-a)}:host([type=primary]:focus-within){box-shadow:0 0 0 2px var(--color-teal-a)}:host([type=default]:focus-within){box-shadow:0 0 0 2px var(--color-grey-a)}:host([type=info]:focus-within){box-shadow:0 0 0 2px var(--color-blue-a)}:host([type=success]:focus-within){box-shadow:0 0 0 2px var(--color-green-a)}:host([type=danger]:focus-within){box-shadow:0 0 0 2px var(--color-red-a)}:host([type=warning]:focus-within){box-shadow:0 0 0 2px var(--color-orange-a)}:host([type=inverse]:focus-within){box-shadow:0 0 0 2px var(--color-dark-a)}:host([type=primary]) .label{border-color:var(--color-teal-2)}:host([type=primary]) .label .prepend,:host([type=primary]) .label .append{border-color:var(--color-teal-a)}:host([type=default]) .label{border-color:var(--color-grey-2)}:host([type=default]) .label .prepend,:host([type=default]) .label .append{border-color:var(--color-grey-a)}:host([type=info]) .label{border-color:var(--color-blue-2)}:host([type=info]) .label .prepend,:host([type=info]) .label .append{border-color:var(--color-blue-a)}:host([type=success]) .label{border-color:var(--color-green-2)}:host([type=success]) .label .prepend,:host([type=success]) .label .append{border-color:var(--color-green-a)}:host([type=danger]) .label{border-color:var(--color-red-2)}:host([type=danger]) .label .prepend,:host([type=danger]) .label .append{border-color:var(--color-red-a)}:host([type=warning]) .label{border-color:var(--color-orange-2)}:host([type=warning]) .label .prepend,:host([type=warning]) .label .append{border-color:var(--color-orange-a)}:host([type=inverse]) .label{border-color:var(--color-dark-2)}:host([type=inverse]) .label .prepend,:host([type=inverse]) .label .append{border-color:var(--color-dark-a)}:host([auto-border]) .label{border-color:transparent}:host([disabled]){cursor:not-allowed}:host([disabled]) .label{border-color:var(--color-grey-1);background:var(--color-plain-1);opacity:.6}:host([readonly]){cursor:default}:host([no-border]),:host(:focus-within[no-border]){box-shadow:none}:host([no-border]) .label,:host(:focus-within[no-border]) .label{border:0}:host([transparent]) .label{background:transparent}</style> <div class="label"> <slot class="prepend" name="prepend"></slot> <input spellcheck="false" /> <wc-icon class="icon"></wc-icon> <slot class="append" name="append"></slot> <div class="suggestion"> <wc-scroll> <ul class="list"></ul> </wc-scroll> </div> </div> ',this.__OUTER__=this.root.children[1],this.__PREPEND__=this.__OUTER__.children[0],this.__INPUT__=this.__OUTER__.children[1],this.__ICO__=this.__OUTER__.children[2],this.__APPEND__=this.__OUTER__.children[3],this.__LIST__=this.__OUTER__.children[4]}get readOnly(){return this.props.readonly}set readOnly(e){var t=typeof e;e!==this.props.readonly&&("boolean"===t&&e||"boolean"!==t?(this.props.readonly=!0,this.setAttribute("readonly",""),this.__INPUT__.setAttribute("readonly","")):(this.props.readonly=!1,this.removeAttribute("readonly"),this.__INPUT__.removeAttribute("readonly")))}get disabled(){return this.props.disabled}set disabled(e){var t=typeof e;e!==this.props.disabled&&("boolean"===t&&e||"boolean"!==t?(this.props.disabled=!0,this.setAttribute("disabled",""),this.__INPUT__.setAttribute("disabled","")):(this.props.disabled=!1,this.removeAttribute("disabled"),this.__INPUT__.removeAttribute("disabled")))}get value(){return this.__INPUT__.value}set value(e){this.__INPUT__.value=e}_moveSelect(e){var{list:t}=this.props;if(t&&t.length){e.preventDefault();var s=38===e.keyCode?-1:1,i=Array.from(this.__LIST__.firstElementChild.firstElementChild.children);null===this.state.mvidx?this.state.mvidx=0:this.state.mvidx+=s,this.state.mvidx<0?this.state.mvidx=0:this.state.mvidx>i.length-1&&(this.state.mvidx=i.length-1),i.forEach((e,t)=>{t===this.state.mvidx?(this.__LIST__.firstElementChild.scrollTop=e.offsetTop-150,e.setAttribute("focus","")):e.removeAttribute("focus")})}}_fetchSelect(e,t){var s=this.props.list[e];this.value=s.value,this.dispatchEvent(new CustomEvent("select",{detail:s})),this._handleChange(t),this.__LIST__.classList.remove("show"),this.state.mvidx=null}connectedCallback(){var e=this.__PREPEND__.assignedNodes(),t=this.__APPEND__.assignedNodes();for(this.stamp=0;e.length>1;)this.removeChild(e.pop());for(;t.length>1;)this.removeChild(t.pop());e.length&&this.__OUTER__.setAttribute("prepend",""),t.length&&this.__OUTER__.setAttribute("append",""),this._handleSubmit=$.catch(this.__INPUT__,"keydown",e=>{let{passwd:t}=this.props;if(!this.disabled&&!this.readOnly){if((38===e.keyCode||40===e.keyCode)&&!t)return this._moveSelect(e);if(13===e.keyCode){if(null!==this.state.mvidx)return this._fetchSelect(this.state.mvidx,e);this.dispatchEvent(new CustomEvent("submit",{detail:this.value}))}}}),this._handleChange=$.bind(this.__INPUT__,"input",e=>{let t=Date.now(),{lazy:s}=this.props;s&&t-this.stamp<s||(this.stamp=t,this.dispatchEvent(new CustomEvent("fetch-suggest",{detail:{value:this.value,send:e=>{this.props.list=e,this._parseSuggestion()}}})))}),this._parseSuggestion=$.bind(this.__INPUT__,"click",e=>{var{list:t}=this.props;let{x:s,y:i,width:o}=this.getBoundingClientRect();if(t&&t.length){var r=t.map((e,t)=>`<li data-idx="${t}">${e.value}</li>`).join("");this.__LIST__.firstElementChild.firstElementChild.innerHTML=r,this.__LIST__.classList.toggle("show",!0),this.__LIST__.style.cssText=`left:${s}px;top:${i+50}px;width:${o}px;`}else this.__LIST__.classList.toggle("show",!1)}),this._inactiveFn=$.outside(this,e=>{this.__LIST__.classList.remove("show")}),this._handleSelect=$.bind(this.__LIST__,"click",e=>{"LI"===e.target.tagName&&(this._fetchSelect(e.target.dataset.idx,e),this.dispatchEvent(new CustomEvent("input")))})}disconnectedCallback(){$.unbind(this.__INPUT__,"keydown",this._handleSubmit),$.unbind(this.__INPUT__,"input",this._handleChange),$.unbind(this.__LIST__,"click",this._handleSelect),$.clearOutside(this._inactiveFn)}attributeChangedCallback(e,t,s){if(t!==s)switch(e){case"icon":this.props.icon=s,s?this.__ICO__.setAttribute("is",s):(this.removeAttribute("icon"),this.__ICO__.removeAttribute("is"));break;case"autofocus":this.__INPUT__.setAttribute("autofocus",""),setTimeout(e=>{this.__INPUT__.focus()},10);break;case"placeholder":this.__INPUT__.setAttribute("placeholder",s);break;case"value":this.value=s;break;case"maxlength":case"minlength":if(null===s)this.__INPUT__.removeAttribute(e);else{+s>0&&this.__INPUT__.setAttribute(e,+s)}break;case"lazy":this.props.lazy=s>>0;break;case"readonly":case"disabled":var i=e;"readonly"===i&&(i="readOnly"),this[i]=null!==s;break;case"passwd":null===s?(this.props.passwd=!1,this.__INPUT__.type="text"):(this.props.passwd=!0,this.__INPUT__.type="password")}}}

if(!customElements.get('wc-input')){
  customElements.define('wc-input', Input)
}
